{% extends 'index.html' %}

{% block content %}



<div class="row mt-4">
    <div class="col-12">

        <!-- Fejléc + gomb -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2">
            <h3 class="mb-0">Reklamációk</h3>
            <a href="{{ url_for('uj_reklamacio') }}" class="btn btn-secondary add-user-btn">
                + Új reklamáció hozzáadása
            </a>
        </div>

        <!-- Táblázat -->
        <div class="table-responsive">
            <table id="reklamaciokTable" class="display responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Dátum</th>
                        <th>Rekl. szám</th>
                        <th>Üzemegység</th>
                        <th>Vevő</th>
                        <th>Termék</th>
                        <th>Hiba típusa</th>
                        <th>NOK</th>
                        <th>Visszaszáll.</th>
                        <th>Kiszállítás</th>
                        <th>Költség (HUF)</th>
                        <th>Státusz</th>
                        <th>Rögzítette</th>
                        <th>Műveletek</th>
                    </tr>
                </thead>

                <tbody>
                    {% for r in rekl %}
                    <tr class="text-center">
                        <td>{{ r.id }}</td>
                        <td>{{ r.complaint_date.strftime('%Y-%m-%d') if r.complaint_date else '' }}</td>
                        <td>{{ r.complaint_number }}</td>
                        <td>{{ r.department.display_name }}</td>
                        <td>{{ r.customer.display_name }}</td>
                        <td>
                            <div class="d-flex flex-column">
                                <span>{{ r.product.display_name }}</span>
                                <small class="text-muted">{{ r.product_identifier }}</small>
                            </div>
                        </td>
                        <td>{{ r.defect_type.display_name }}</td>
                        <td class="text-end">{{ r.quantity }}</td>

                        <td>
                            {% if r.requires_return  %}
                                <span class="badge bg-success">Igen</span>
                            {% else %}
                                <span class="badge bg-danger">Nem</span>
                            {% endif %}
                        </td>

                        <td>{{ r.shipping_date.strftime('%Y-%m-%d') if r.shipping_date else '' }}</td>
                        <td class="text-end">{{ "{:,}".format(r.total_cost or 0).replace(",", " ") }}</td>
                        
                        <td>
                            {% if r.status.name == 'folyamatban' %}
                                <span class="badge bg-info text-dark">Folyamatban</span>
                            {% elif r.status.name == 'elfogadva' %}
                                <span class="badge bg-success">Elfogadva</span>
                            {% elif r.status.name == 'visszautasítva' %}
                                <span class="badge bg-danger">Visszautasítva</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ r.status.name }}</span>
                            {% endif %}
                        </td>

                        <td>
                            {{ r.user.surname }} {{ r.user.forename }}
                        </td>

                        <td class="text-nowrap">
                            <a href="{{ url_for('modosit_reklamacio', reklamacio_id=r.id) }}" class="btn btn-sm btn-primary ms-2">Módosítás</a>
                            <a href="{{ url_for('torol_reklamacio', reklamacio_id=r.id) }}" class="btn btn-sm btn-danger ms-2">Törlés</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock content %}

{% block scripts %}
    {{ super() }}

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/2.3.5/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/3.0.7/js/dataTables.responsive.min.js"></script>

    <!-- DataTables inicializálása -->
    <script>
        $(document).ready(function() {
            $('#reklamaciokTable').DataTable({
                responsive: true,
                language: {
                    url: "https://cdn.datatables.net/plug-ins/2.3.5/i18n/hu.json"
                },
                order: [[ 1, "desc" ]] 
            });
        });
    </script>

{% endblock scripts %}
